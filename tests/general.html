<html>
<head>
<script src='../build/canvas/amino.js'></script>
<script src='../build/canvas/widgets.js'></script>
<script src='../build/canvas/canvasbacon.js'></script>
<script src='../build/canvas/canvasamino.js'></script>
<script src='generalutil.js'></script>
<style type="text/css">
canvas { border: 1px solid black; }
</style>
</head>
<body>
<canvas id='mycanvas' width='600' height='300'></canvas>
<script language="JavaScript">
amino.setCanvas("mycanvas");
amino.startApp(function(core,stage) {
    var root = new amino.ProtoGroup();
    stage.setRoot(root);
    
    
    var col1 = 5;
    var col2 = 150;
    var colw = 140;
    var col3 = 295;
    var col4 = col3+150;
    
    root.add(new amino.ProtoGroup()
        .add(new widgets.Label().setText("rect"))
        .add(new amino.ProtoRect().setW(30).setH(30).setFill("#00ff00").setTy(30))
        .setTx(col1).setTy(0)
        );
    
    root.add(new amino.ProtoGroup()
        .add(new widgets.Label().setText("text"))
        .add(new amino.ProtoText().setFill("#cc6655").setTy(40).setText("some text"))
        .setTx(col2).setTy(0)
        );
    
    root.add(new amino.ProtoGroup()
        .add(new widgets.Label().setText("button"))
        .add(new widgets.PushButton().setText("a button").setW(70).setH(30).setTy(30))
        .setTx(col3).setTy(0)
        );
    
    root.add(new amino.ProtoGroup()
        .add(new widgets.Label().setText("toggle button"))
        .add(new widgets.ToggleButton().setText("a button").setW(70).setH(30).setTy(30))
        .setTx(col4).setTy(0)
        );
    
    root.add(new widgets.AnchorPanel()
        .add(new widgets.Label().setText("label left"))
        .add(new widgets.Label().setText("X").setW(colw).setH(30).setTy(30).setAlign("left"))
        .setTx(col1).setTy(100).setW(colw).setH(95)
        );
    root.add(new widgets.AnchorPanel()
        .add(new widgets.Label().setText("label center"))
        .add(new widgets.Label().setText("X").setW(colw).setH(30).setTy(30).setAlign("center"))
        .setTx(col2).setTy(100).setW(colw).setH(95)
        );
    root.add(new widgets.AnchorPanel()
        .add(new widgets.Label().setText("label right"))
        .add(new widgets.Label().setText("X").setW(colw).setH(30).setTy(30).setAlign("right"))
        .setTx(col3).setTy(100).setW(colw).setH(95)
        );
/*    
    root.add(new widgets.AnchorPanel()
        .add(new widgets.Label().setText("progress spinner"))
        .add(new widgets.ProgressSpinner().setActive(true).setTy(30).setTx(30))
        .setTx(col1).setTy(100).setW(colw).setH(95)
        );
        */
    /*
    function a(node, prop, start, finish, dur) {
        return {
            node:node,
            prop:prop,
            sval:start,
            fval:finish,
            dur:dur,
            running:false,
            finished:false,
            easefn:null,
            update:function() {
                if(this.finished) return;
                if(!this.running) {
                    this.startTime = new Date().getTime();
                    this.running = true;
                    return;
                }
                var time = new Date().getTime();
                var dt = time-this.startTime;
                var t = dt/this.dur;
                if(t > 1) {
                    this.finished = true;
                    return;
                }
                if(this.easefn != null) {
                    t = this.easefn(t);
                }
                var v = (this.fval-this.sval)*t + this.sval;
                //console.log("t = " + t + " " + v);
                node["set"+camelize(this.prop)](v);
            },
            setEase:function(easefn) {
                this.easefn = easefn;
                return this;
            }
        };
    }
    
    function chain() {
        var args = Array.prototype.slice.call(arguments);
        return {
            anims:args,
            curr:null,
            finished:false,
            afterf:null,
            update:function() {
                if(this.finished) return;
                if(!this.curr) {
                    this.curr = this.anims.shift();
                }
                this.curr.update();
                if(this.curr.finished) {
                    if(this.anims.length == 0) {
                        this.finished = true;
                        if(this.afterf) this.afterf();
                    } else {
                        this.curr = this.anims.shift();
                    }
                }
                
            },
            after:function(f) {
                this.afterf = f;
                return this;
            }
        }
    }
    
    function together() {
        var args = Array.prototype.slice.call(arguments);
        return {
            anims:args,
            finished:false,
            update:function() {
                if(this.finished) return;
                var anyLeft = false;
                for(var i in this.anims) {
                    if(!this.anims[i].finished) {
                        this.anims[i].update();
                        anyLeft = true;
                    }
                }
                if(!anyLeft) {
                    this.finished = true;
                    if(this.afterf) this.afterf();
                }
            },
            after:function(f) {
                this.afterf = f;
                return this;
            }
        }
    }
    function anims(c,core,stage) {
        var rect = new Rect();    
        rect.setX(0);
        rect.setY(0);
        rect.setW(20);
        rect.setH(20);
        rect.setFill("red");
        c.add(rect);
        var anim = chain(
            together(
                a(rect,"x",0,100,1000),
                a(rect,"y",0,100,1000)
            ),
            chain(
                a(rect,"x",100, 200,1000).setEase(elasticOut),
                a(rect,"y",100,  50,500).setEase(cubicInOut),
                a(rect,"x",200, 100,500).setEase(cubicInOut)
            ),
            together(
                a(rect,"x",100,0,500).setEase(cubicInOut),
                a(rect,"y",50, 0,500).setEase(cubicInOut)
            )
            ).after(function() {
                console.log("all done!");
            });
        stage.addAnim(anim);
    }
    */
});
</script>
</body>
</html>
